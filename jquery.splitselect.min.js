/**
 * --------------------------------------------------------------------
 * jQuery-Plugin "SplitSelect". Minified.
 * Version: 1.1, 28/07/2011
 * by Alex Skrypnyk, alex.designworks@gmail.com
 *
 * Copyright 2010 Alex Skrypnyk
 * Licensed under GPL (http://www.gnu.org/licenses/gpl-2.0.html)
 *
 * Changelog:
 *    changelog.txt
 * --------------------------------------------------------------------
 * @example $(function(){$('.splitselect').selectparser();});
 * @desc Parses all form element select with class 'splitselect' and creates multiple selects with parsed value for each of parsed selects.
 *
 * --------------------------------------------------------------------
 * Please, leave this header when copying.
 */

(function($){var opt;var originalSelects=new Object();var SplitSelects=new Object();var indexes=new Array();var delim='___';$.fn.splitselect=function(options){opt=$.extend({classname:'splitselectel',defaultText:'Please select',hideFX:{fx:"fade",settingsFX:{duration:500}},hidesource:true,showFX:{fx:"fade",duration:500,settingsFX:{},cb:null},orientation:"horizontal",splitter:' - '},options);$(this).each(function(){var id=$(this).attr("id");originalSelects[id]=new Object();$(this).children('option').each(function(j){originalSelects[id][$(this).attr("value").toString()]=$(this).attr("text");});for(var sk in originalSelects){for(var ok in originalSelects[sk]){if(ok!=""){addSplitSelect(sk,originalSelects[sk][ok].split(opt.splitter));}}}
if(opt.hidesource){$(this).hide();}
$(this).showSelect(id,"root");});return $(this);};$.fn.showSelect=function(id,val){var sid='#'+encodeID(id,val);if($(sid).length==0){var rs=renderSelect(id,val);if(rs!=""){this.appendToDOM(rs,opt.orientation);$(sid).bind('change',{dataID:id},function(event){var val=$(this).find(':selected').text();if(!empty(val)){$(this).hideSelect(event.data.dataID,val);$(this).showSelect(event.data.dataID,val);}});}else{var t=getConcatSelectedText(id);var options=$('#'+id).find('option').not($('[value=""]'));for(var i=0;i<options.length;i++){if(options[i].text==t){$('#'+id).attr("value",options[i].value);}}}}
$(sid).hide().showFX();}
$.fn.hideSelect=function(id,val){var options=$(this).find('option').not($('[value=""]'));for(var i=0;i<options.length;i++){$('#'+encodeID(id,options[i].text)).each(function(){$(this).hideFX();$(this).attr('value','');$(this).hideSelect(id,options[i].text);});}}
$.fn.appendToDOM=function(html){if(opt.orientation=="vertical"||opt.orientation=="v"){$(this).after('<div css="display:block">'+html+'</div>');}else{$(this).after(html);}}
$.fn.showFX=function(){if(typeof $.fn.effect=='function'&&typeof $.effects[opt.showFX.fx]=='function'){$(this).effect(opt.showFX.fx,opt.showFX.settingsFX,opt.showFX.duration,opt.showFX.cb);}else{$(this).fadeIn(opt.showFX.duration);}}
$.fn.hideFX=function(){if(typeof $.fn.effect=='function'&&typeof $.effects[opt.hideFX.fx]=='function'){$(this).effect(opt.hideFX.fx,opt.hideFX.settingsFX,opt.hideFX.duration,opt.hideFX.cb);}else{$(this).fadeOut();$(this).hide();}}
function renderSelect(selectID,parentVal){var o="";if(!empty(SplitSelects[selectID][idx(parentVal)])){o+='<select id="'+encodeID(selectID,parentVal)+'" class="'+opt.classname+'">';o+='<option value="">'+opt.defaultText+'</option>';for(var i in SplitSelects[selectID][idx(parentVal)]){o+='<option value = "'+SplitSelects[selectID][idx(parentVal)][i]+'">';o+=SplitSelects[selectID][idx(parentVal)][i];o+='</option>';}
o+='</select>';}
return o;}
function getConcatSelectedText(id){var v="";$('.'+opt.classname).not(':hidden').each(function(){if(decodeSourceID($(this).attr('id'))==id){v+=$(this).find(':selected').text()+opt.splitter;}});return v.substring(0,v.length-opt.splitter.length);}
function addSplitSelect(srcSelectId,SplitTexts){if(empty(SplitSelects[srcSelectId])){SplitSelects[srcSelectId]=new Object();}
for(var stk in SplitTexts){var prevLevelText="";var currLevelText=SplitTexts[stk];if(stk==0){prevLevelText="root";}else{prevLevelText=SplitTexts[stk-1];}
if(empty(SplitSelects[srcSelectId][idx(prevLevelText)])){SplitSelects[srcSelectId][idx(prevLevelText)]=new Object();}
if(empty(SplitSelects[srcSelectId][idx(prevLevelText)][idx(currLevelText)])){SplitSelects[srcSelectId][idx(prevLevelText)][idx(currLevelText)]=new Object();}
SplitSelects[srcSelectId][idx(prevLevelText)][idx(currLevelText)]=currLevelText;}}
function encodeID(id,val){return id+delim+idx(val);}
function decodeSourceID(encodedID){return encodedID.substring(0,encodedID.indexOf(delim))}
function idx(s){var idx=-1;for(var i in indexes){if(indexes[i]==s){idx=i;}}
if(idx<0){indexes.push(s);return indexes.length;}
else{return idx;}}
function uidx(i){if(!empty(indexes[i])){return indexes[i];}
return"";}
function empty(mixed_var){var key;if(mixed_var===""||mixed_var===0||mixed_var==="0"||mixed_var===null||mixed_var===false||typeof mixed_var==='undefined'){return true;}
if(typeof mixed_var=='object'){for(key in mixed_var){return false;}
return true;}
return false;}})(jQuery);